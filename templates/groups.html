
{% extends "layout.html" %}

{% block title %}
  groups
{% endblock %}

{% block js %}
<script type="text/javascript">
  // var user_info = {{ user_info | safe }};
  // var following_user_info = {{following_user_info |safe }}
  // var followed_user_info = {{followed_user_info |safe }}
  var groups = {{ groups | safe }}
  var requests_groups = {{ requests_groups | safe }}
</script>

<script>
  jQuery(function($) {

  //data-hrefの属性を持つtrを選択しclassにclickableを付加
  $('tr[data-href]').addClass('clickable')

    //クリックイベント
    .click(function(e) {

      //e.targetはクリックした要素自体、それがa要素以外であれば
      if(!$(e.target).is('a')){
      
        //その要素の先祖要素で一番近いtrの
        //data-href属性の値に書かれているURLに遷移する
        window.location = $(e.target).closest('tr').data('href');}
  });
});
</script>

{% endblock %}

{% block main %}
<div class="col-xs-10" style="padding: 40px 0 40px 0;">
<h1 style="font-size: 25px; text-align: center">グループ一覧</h1>

<!-- <p>{{ groups['name'] }}</p> -->
<table class="table table-hover">
  <thead>
    <tr>
      <th></th>
      <!-- <th>グループid</th> -->
      <th>グループ名</th>
    </tr>
  </thead>
  <tbody>
    {% for d in groups %}
    <tr data-href="{{ url_for('group_info', group_id = d['id'] ) }}">
      <td><i class="fas fa-user"></i></td>
      <!-- <td>{{ d["id"]}}</td> -->
      <td>{{ d["name"]}}</td>
    </tr>
    {% endfor %}
  </tbody>
</table>

{% if requests_groups %}
<h3 style="font-size: 25px; text-align: center">招待一覧</h3>
<table class="table table-hover">
  <thead>
    <tr>
      <th></th>
      <!-- <th>グループid</th> -->
      <th>グループ名</th>
    </tr>
  </thead>
  <tbody>
    {% for d in requests_groups %}
    <tr data-href="{{ url_for('group_info', group_id = d['id'] ) }}">
      <td><i class="fas fa-user"></i></td>
      <!-- <td>{{ d["id"]}}</td> -->
      <td>{{ d["name"]}}</td>
      <td>オーナ{{ d["owner_id"]}}</td>

      <td>
        <form action="/groups" method="post">
          <input type="hidden" name ="group_id"value='{{ d["id"]}}'>
          <input type="hidden" name ="owner_id"value='{{ d["owner_id"]}}'>
          <button class="btn btn-primary" type='submit' name='auth' value="yes" >参加</button>
        </form>
      </td>
      <td>
        <form action="/groups" method="post">
          <input type="hidden" name ="group_id"value='{{ d["id"]}}'>
          <input type="hidden" name ="owner_id"value='{{ d["owner_id"]}}'>
          <button class="btn btn-primary" type='submit' name='auth' value="no" >拒否</button>
        </form>
      </td>

    </tr>
  </tr>
    {% endfor %}
  </tbody>
</table>
{% endif %}

<div style="text-align: center">
    <button onclick="location.href='create_group'" type="button" class="btn btn-primary">新規作成</button>
</div>
</div>
{% endblock %}